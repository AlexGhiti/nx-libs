#!/usr/bin/make -f

NULL =
CFLAGS = -Wall -g

ifneq (,$(findstring noopt,$(DEB_BUILD_OPTIONS)))
        CFLAGS += -O0
else
        CFLAGS += -O2
endif

export LIBDIR = "/usr/lib/$(shell dpkg-architecture -qDEB_BUILD_MULTIARCH)"
export INCLUDEDIR = "/usr/include/$(shell dpkg-architecture -qDEB_BUILD_MULTIARCH)"

%:
	CONFIGURE="./configure --with-symbols --prefix=/usr --libdir=$(LIBDIR) --includedir=$(INCLUDEDIR)" dh $@ --with quilt

# before build, we will remove unused code / bundled libraries (keep this in sync with roll-tarball.sh)
UNUSED_FOLDERS = nx-X11/extras/drm/ \
                 nx-X11/extras/expat/ \
                 nx-X11/extras/fontconfig/ \
                 nx-X11/extras/freetype2/ \
                 nx-X11/extras/fonts/ \
                 nx-X11/extras/ogl-sample/ \
                 nx-X11/extras/regex/ \
                 nx-X11/extras/rman/ \
                 nx-X11/extras/ttf2pt1/ \
                 nx-X11/extras/x86emu/ \
                 nx-X11/extras/zlib/ \
                 nx-X11/lib/expat/ \
                 nx-X11/lib/fontconfig/ \
                 nx-X11/lib/fontenc/ \
                 nx-X11/lib/font/FreeType/ \
                 nx-X11/lib/font/include/fontenc.h \
                 nx-X11/lib/freetype2/ \
                 nx-X11/lib/regex/ \
                 nx-X11/lib/zlib/ \
                 nx-X11/lib/FS/ \
                 nx-X11/lib/ICE/ \
                 nx-X11/lib/SM/ \
                 nx-X11/lib/Xaw/ \
                 nx-X11/lib/Xft/ \
                 nx-X11/lib/Xt/ \
                 nx-X11/lib/Xmu/ \
                 nx-X11/lib/Xmuu/ \
                 nx-X11/extras/Mesa/bin/ \
                 nx-X11/extras/Mesa/config/ \
                 nx-X11/extras/Mesa/docs/ \
                 nx-X11/extras/Mesa/vms/ \
                 nx-X11/extras/Mesa/windows/ \
                 nx-X11/extras/Mesa/src/glw/ \
                 nx-X11/extras/Mesa/src/glx/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/fb/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/ffb/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/gamma/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/i810/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/i830/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/i915/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/mach64/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/mga/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/r128/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/r200/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/r300/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/radeon/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/s3v/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/savage/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/sis/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/tdfx/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/trident/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/unichrome/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/dri/x11/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/fbdev/ \
                 nx-X11/extras/Mesa/src/mesa/drivers/glide/ \
                 nx-X11/programs/Xserver/hw/darwin/ \
                 nx-X11/programs/Xserver/hw/dmx/ \
                 nx-X11/programs/Xserver/hw/kdrive/ \
                 nx-X11/programs/Xserver/hw/sun/ \
                 nx-X11/programs/Xserver/hw/sunLynx/ \
                 nx-X11/programs/Xserver/hw/vfb/ \
                 nx-X11/programs/Xserver/hw/xnest/ \
                 nx-X11/programs/Xserver/hw/xwin/ \
                 nx-X11/programs/Xserver/hw/xfree86/ \
                 nx-X11/programs/Xserver/miext/shadow/ \
                 nx-X11/programs/Xserver/XpConfig/ \
                 nx-X11/programs/Xserver/Xprint/ \
                 nx-X11/programs/xterm/ \
                 $(NULL)

CLEANUP_FOLDERS = nx-X11/extras/Mesa/ \
                  nx-X11/extras/Xpm/ \
                  $(NULL)

PRESERVE_SYMLINKED_FILES = nx-X11/extras/Mesa/include/GL/glext.h \
                           nx-X11/extras/Mesa/include/GL/gl.h \
                           nx-X11/extras/Mesa/include/GL/glxext.h \
                           nx-X11/extras/Mesa/include/GL/internal/glcore.h \
                           nx-X11/extras/Mesa/include/GL/osmesa.h \
                           nx-X11/extras/Mesa/include/GL/xmesa.h \
                           nx-X11/extras/Mesa/include/GL/xmesa_xf86.h \
                           nx-X11/extras/Mesa/src/glx/x11/compsize.c \
                           nx-X11/extras/Mesa/src/glx/x11/indirect_size.c \
                           nx-X11/extras/Mesa/src/glx/x11/indirect_size.h \
                           nx-X11/extras/Mesa/src/mesa/array_cache/acache.h \
                           nx-X11/extras/Mesa/src/mesa/array_cache/ac_context.c \
                           nx-X11/extras/Mesa/src/mesa/array_cache/ac_context.h \
                           nx-X11/extras/Mesa/src/mesa/array_cache/ac_import.c \
                           nx-X11/extras/Mesa/src/mesa/drivers/common/driverfuncs.c \
                           nx-X11/extras/Mesa/src/mesa/drivers/common/driverfuncs.h \
                           nx-X11/extras/Mesa/src/mesa/drivers/dri/common/glcontextmodes.c \
                           nx-X11/extras/Mesa/src/mesa/drivers/dri/common/glcontextmodes.h \
                           nx-X11/extras/Mesa/src/mesa/drivers/x11/glxheader.h \
                           nx-X11/extras/Mesa/src/mesa/drivers/x11/xm_api.c \
                           nx-X11/extras/Mesa/src/mesa/drivers/x11/xm_buffer.c \
                           nx-X11/extras/Mesa/src/mesa/drivers/x11/xm_dd.c \
                           nx-X11/extras/Mesa/src/mesa/drivers/x11/xm_line.c \
                           nx-X11/extras/Mesa/src/mesa/drivers/x11/xm_span.c \
                           nx-X11/extras/Mesa/src/mesa/drivers/x11/xm_tri.c \
                           nx-X11/extras/Mesa/src/mesa/drivers/x11/xmesaP.h \
                           nx-X11/extras/Mesa/src/mesa/glapi/dispatch.h \
                           nx-X11/extras/Mesa/src/mesa/glapi/glapi.c \
                           nx-X11/extras/Mesa/src/mesa/glapi/glapi.h \
                           nx-X11/extras/Mesa/src/mesa/glapi/glapitable.h \
                           nx-X11/extras/Mesa/src/mesa/glapi/glapitemp.h \
                           nx-X11/extras/Mesa/src/mesa/glapi/glapioffsets.h \
                           nx-X11/extras/Mesa/src/mesa/glapi/glprocs.h \
                           nx-X11/extras/Mesa/src/mesa/glapi/glthread.c \
                           nx-X11/extras/Mesa/src/mesa/glapi/glthread.h \
                           nx-X11/extras/Mesa/src/mesa/main/accum.c \
                           nx-X11/extras/Mesa/src/mesa/main/accum.h \
                           nx-X11/extras/Mesa/src/mesa/main/api_arrayelt.c \
                           nx-X11/extras/Mesa/src/mesa/main/api_arrayelt.h \
                           nx-X11/extras/Mesa/src/mesa/main/api_eval.h \
                           nx-X11/extras/Mesa/src/mesa/main/api_loopback.c \
                           nx-X11/extras/Mesa/src/mesa/main/api_loopback.h \
                           nx-X11/extras/Mesa/src/mesa/main/api_noop.c \
                           nx-X11/extras/Mesa/src/mesa/main/api_noop.h \
                           nx-X11/extras/Mesa/src/mesa/main/api_validate.c \
                           nx-X11/extras/Mesa/src/mesa/main/api_validate.h \
                           nx-X11/extras/Mesa/src/mesa/main/attrib.c \
                           nx-X11/extras/Mesa/src/mesa/main/attrib.h \
                           nx-X11/extras/Mesa/src/mesa/main/blend.c \
                           nx-X11/extras/Mesa/src/mesa/main/blend.h \
                           nx-X11/extras/Mesa/src/mesa/main/bufferobj.c \
                           nx-X11/extras/Mesa/src/mesa/main/bufferobj.h \
                           nx-X11/extras/Mesa/src/mesa/main/buffers.c \
                           nx-X11/extras/Mesa/src/mesa/main/buffers.h \
                           nx-X11/extras/Mesa/src/mesa/main/clip.c \
                           nx-X11/extras/Mesa/src/mesa/main/clip.h \
                           nx-X11/extras/Mesa/src/mesa/main/colormac.h \
                           nx-X11/extras/Mesa/src/mesa/main/colortab.c \
                           nx-X11/extras/Mesa/src/mesa/main/colortab.h \
                           nx-X11/extras/Mesa/src/mesa/main/config.h \
                           nx-X11/extras/Mesa/src/mesa/main/context.c \
                           nx-X11/extras/Mesa/src/mesa/main/context.h \
                           nx-X11/extras/Mesa/src/mesa/main/convolve.c \
                           nx-X11/extras/Mesa/src/mesa/main/convolve.h \
                           nx-X11/extras/Mesa/src/mesa/main/dd.h \
                           nx-X11/extras/Mesa/src/mesa/main/debug.c \
                           nx-X11/extras/Mesa/src/mesa/main/debug.h \
                           nx-X11/extras/Mesa/src/mesa/main/depth.c \
                           nx-X11/extras/Mesa/src/mesa/main/depth.h \
                           nx-X11/extras/Mesa/src/mesa/main/dispatch.c \
                           nx-X11/extras/Mesa/src/mesa/main/dlist.c \
                           nx-X11/extras/Mesa/src/mesa/main/dlist.h \
                           nx-X11/extras/Mesa/src/mesa/main/drawpix.c \
                           nx-X11/extras/Mesa/src/mesa/main/drawpix.h \
                           nx-X11/extras/Mesa/src/mesa/main/enable.c \
                           nx-X11/extras/Mesa/src/mesa/main/enable.h \
                           nx-X11/extras/Mesa/src/mesa/main/enums.c \
                           nx-X11/extras/Mesa/src/mesa/main/enums.h \
                           nx-X11/extras/Mesa/src/mesa/main/eval.c \
                           nx-X11/extras/Mesa/src/mesa/main/eval.h \
                           nx-X11/extras/Mesa/src/mesa/main/execmem.c \
                           nx-X11/extras/Mesa/src/mesa/main/extensions.c \
                           nx-X11/extras/Mesa/src/mesa/main/extensions.h \
                           nx-X11/extras/Mesa/src/mesa/main/fbobject.c \
                           nx-X11/extras/Mesa/src/mesa/main/fbobject.h \
                           nx-X11/extras/Mesa/src/mesa/main/feedback.c \
                           nx-X11/extras/Mesa/src/mesa/main/feedback.h \
                           nx-X11/extras/Mesa/src/mesa/main/fog.c \
                           nx-X11/extras/Mesa/src/mesa/main/fog.h \
                           nx-X11/extras/Mesa/src/mesa/main/framebuffer.c \
                           nx-X11/extras/Mesa/src/mesa/main/framebuffer.h \
                           nx-X11/extras/Mesa/src/mesa/main/get.c \
                           nx-X11/extras/Mesa/src/mesa/main/get.h \
                           nx-X11/extras/Mesa/src/mesa/main/getstring.c \
                           nx-X11/extras/Mesa/src/mesa/main/glheader.h \
                           nx-X11/extras/Mesa/src/mesa/main/hash.c \
                           nx-X11/extras/Mesa/src/mesa/main/hash.h \
                           nx-X11/extras/Mesa/src/mesa/main/hint.c \
                           nx-X11/extras/Mesa/src/mesa/main/hint.h \
                           nx-X11/extras/Mesa/src/mesa/main/histogram.c \
                           nx-X11/extras/Mesa/src/mesa/main/histogram.h \
                           nx-X11/extras/Mesa/src/mesa/main/image.c \
                           nx-X11/extras/Mesa/src/mesa/main/image.h \
                           nx-X11/extras/Mesa/src/mesa/main/imports.c \
                           nx-X11/extras/Mesa/src/mesa/main/imports.h \
                           nx-X11/extras/Mesa/src/mesa/main/light.c \
                           nx-X11/extras/Mesa/src/mesa/main/light.h \
                           nx-X11/extras/Mesa/src/mesa/main/lines.c \
                           nx-X11/extras/Mesa/src/mesa/main/lines.h \
                           nx-X11/extras/Mesa/src/mesa/main/macros.h \
                           nx-X11/extras/Mesa/src/mesa/main/matrix.c \
                           nx-X11/extras/Mesa/src/mesa/main/matrix.h \
                           nx-X11/extras/Mesa/src/mesa/main/mm.c \
                           nx-X11/extras/Mesa/src/mesa/main/mm.h \
                           nx-X11/extras/Mesa/src/mesa/main/mtypes.h \
                           nx-X11/extras/Mesa/src/mesa/main/occlude.c \
                           nx-X11/extras/Mesa/src/mesa/main/occlude.h \
                           nx-X11/extras/Mesa/src/mesa/main/pixel.c \
                           nx-X11/extras/Mesa/src/mesa/main/pixel.h \
                           nx-X11/extras/Mesa/src/mesa/main/points.c \
                           nx-X11/extras/Mesa/src/mesa/main/points.h \
                           nx-X11/extras/Mesa/src/mesa/main/polygon.c \
                           nx-X11/extras/Mesa/src/mesa/main/polygon.h \
                           nx-X11/extras/Mesa/src/mesa/main/rastpos.c \
                           nx-X11/extras/Mesa/src/mesa/main/rastpos.h \
                           nx-X11/extras/Mesa/src/mesa/main/renderbuffer.c \
                           nx-X11/extras/Mesa/src/mesa/main/renderbuffer.h \
                           nx-X11/extras/Mesa/src/mesa/main/simple_list.h \
                           nx-X11/extras/Mesa/src/mesa/main/state.c \
                           nx-X11/extras/Mesa/src/mesa/main/state.h \
                           nx-X11/extras/Mesa/src/mesa/main/stencil.c \
                           nx-X11/extras/Mesa/src/mesa/main/stencil.h \
                           nx-X11/extras/Mesa/src/mesa/main/texcompress.c \
                           nx-X11/extras/Mesa/src/mesa/main/texcompress_fxt1.c \
                           nx-X11/extras/Mesa/src/mesa/main/texcompress.h \
                           nx-X11/extras/Mesa/src/mesa/main/texcompress_s3tc.c \
                           nx-X11/extras/Mesa/src/mesa/main/texenvprogram.c \
                           nx-X11/extras/Mesa/src/mesa/main/texenvprogram.h \
                           nx-X11/extras/Mesa/src/mesa/main/texformat.c \
                           nx-X11/extras/Mesa/src/mesa/main/texformat.h \
                           nx-X11/extras/Mesa/src/mesa/main/texformat_tmp.h \
                           nx-X11/extras/Mesa/src/mesa/main/teximage.c \
                           nx-X11/extras/Mesa/src/mesa/main/teximage.h \
                           nx-X11/extras/Mesa/src/mesa/main/texobj.c \
                           nx-X11/extras/Mesa/src/mesa/main/texobj.h \
                           nx-X11/extras/Mesa/src/mesa/main/texrender.c \
                           nx-X11/extras/Mesa/src/mesa/main/texrender.h \
                           nx-X11/extras/Mesa/src/mesa/main/texstate.c \
                           nx-X11/extras/Mesa/src/mesa/main/texstate.h \
                           nx-X11/extras/Mesa/src/mesa/main/texstore.c \
                           nx-X11/extras/Mesa/src/mesa/main/texstore.h \
                           nx-X11/extras/Mesa/src/mesa/main/varray.c \
                           nx-X11/extras/Mesa/src/mesa/main/varray.h \
                           nx-X11/extras/Mesa/src/mesa/main/version.h \
                           nx-X11/extras/Mesa/src/mesa/main/vtxfmt.c \
                           nx-X11/extras/Mesa/src/mesa/main/vtxfmt.h \
                           nx-X11/extras/Mesa/src/mesa/main/vtxfmt_tmp.h \
                           nx-X11/extras/Mesa/src/mesa/main/WSDrawBuffer.h \
                           nx-X11/extras/Mesa/src/mesa/math/mathmod.h \
                           nx-X11/extras/Mesa/src/mesa/math/m_clip_tmp.h \
                           nx-X11/extras/Mesa/src/mesa/math/m_copy_tmp.h \
                           nx-X11/extras/Mesa/src/mesa/math/m_debug_clip.c \
                           nx-X11/extras/Mesa/src/mesa/math/m_debug.h \
                           nx-X11/extras/Mesa/src/mesa/math/m_debug_norm.c \
                           nx-X11/extras/Mesa/src/mesa/math/m_debug_util.h \
                           nx-X11/extras/Mesa/src/mesa/math/m_debug_xform.c \
                           nx-X11/extras/Mesa/src/mesa/math/m_dotprod_tmp.h \
                           nx-X11/extras/Mesa/src/mesa/math/m_eval.c \
                           nx-X11/extras/Mesa/src/mesa/math/m_eval.h \
                           nx-X11/extras/Mesa/src/mesa/math/m_matrix.c \
                           nx-X11/extras/Mesa/src/mesa/math/m_matrix.h \
                           nx-X11/extras/Mesa/src/mesa/math/m_norm_tmp.h \
                           nx-X11/extras/Mesa/src/mesa/math/m_translate.c \
                           nx-X11/extras/Mesa/src/mesa/math/m_translate.h \
                           nx-X11/extras/Mesa/src/mesa/math/m_trans_tmp.h \
                           nx-X11/extras/Mesa/src/mesa/math/m_vector.c \
                           nx-X11/extras/Mesa/src/mesa/math/m_vector.h \
                           nx-X11/extras/Mesa/src/mesa/math/m_xform.c \
                           nx-X11/extras/Mesa/src/mesa/math/m_xform.h \
                           nx-X11/extras/Mesa/src/mesa/math/m_xform_tmp.h \
                           nx-X11/extras/Mesa/src/mesa/shader/arbfragparse.c \
                           nx-X11/extras/Mesa/src/mesa/shader/arbfragparse.h \
                           nx-X11/extras/Mesa/src/mesa/shader/arbprogparse.c \
                           nx-X11/extras/Mesa/src/mesa/shader/arbprogparse.h \
                           nx-X11/extras/Mesa/src/mesa/shader/arbprogram.c \
                           nx-X11/extras/Mesa/src/mesa/shader/arbprogram.h \
                           nx-X11/extras/Mesa/src/mesa/shader/arbprogram_syn.h \
                           nx-X11/extras/Mesa/src/mesa/shader/arbvertparse.c \
                           nx-X11/extras/Mesa/src/mesa/shader/arbvertparse.h \
                           nx-X11/extras/Mesa/src/mesa/shader/atifragshader.c \
                           nx-X11/extras/Mesa/src/mesa/shader/atifragshader.h \
                           nx-X11/extras/Mesa/src/mesa/shader/grammar/grammar.c \
                           nx-X11/extras/Mesa/src/mesa/shader/grammar/grammar.h \
                           nx-X11/extras/Mesa/src/mesa/shader/grammar/grammar_mesa.c \
                           nx-X11/extras/Mesa/src/mesa/shader/grammar/grammar_mesa.h \
                           nx-X11/extras/Mesa/src/mesa/shader/grammar/grammar_syn.h \
                           nx-X11/extras/Mesa/src/mesa/shader/nvfragparse.c \
                           nx-X11/extras/Mesa/src/mesa/shader/nvfragparse.h \
                           nx-X11/extras/Mesa/src/mesa/shader/nvfragprog.h \
                           nx-X11/extras/Mesa/src/mesa/shader/nvprogram.c \
                           nx-X11/extras/Mesa/src/mesa/shader/nvprogram.h \
                           nx-X11/extras/Mesa/src/mesa/shader/nvvertexec.c \
                           nx-X11/extras/Mesa/src/mesa/shader/nvvertexec.h \
                           nx-X11/extras/Mesa/src/mesa/shader/nvvertparse.c \
                           nx-X11/extras/Mesa/src/mesa/shader/nvvertparse.h \
                           nx-X11/extras/Mesa/src/mesa/shader/nvvertprog.h \
                           nx-X11/extras/Mesa/src/mesa/shader/program.c \
                           nx-X11/extras/Mesa/src/mesa/shader/program.h \
                           nx-X11/extras/Mesa/src/mesa/shader/shaderobjects_3dlabs.c \
                           nx-X11/extras/Mesa/src/mesa/shader/shaderobjects_3dlabs.h \
                           nx-X11/extras/Mesa/src/mesa/shader/shaderobjects.c \
                           nx-X11/extras/Mesa/src/mesa/shader/shaderobjects.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/library/slang_common_builtin_gc_bin.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/library/slang_common_builtin_gc.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/library/slang_core_gc_bin.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/library/slang_core_gc.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/library/slang_fragment_builtin_gc_bin.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/library/slang_fragment_builtin_gc.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/library/slang_shader_syn.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/library/slang_version_syn.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/library/slang_vertex_builtin_gc_bin.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/library/slang_vertex_builtin_gc.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_assemble_assignment.c \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_assemble_assignment.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_assemble.c \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_assemble_conditional.c \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_assemble_conditional.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_assemble_constructor.c \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_assemble_constructor.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_assemble.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_assemble_typeinfo.c \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_assemble_typeinfo.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_compile.c \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_compile.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_execute.c \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_execute.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_preprocess.c \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_preprocess.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_storage.c \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_storage.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_utility.c \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/slang_utility.h \
                           nx-X11/extras/Mesa/src/mesa/shader/slang/traverse_wrap.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_aaline.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_aaline.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_aalinetemp.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_aatriangle.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_aatriangle.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_aatritemp.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_accum.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_accum.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_alpha.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_alpha.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_atifragshader.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_atifragshader.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_bitmap.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_blend.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_blend.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_buffers.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_context.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_context.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_copypix.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_depth.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_depth.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_drawpix.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_drawpix.h \
                           nx-X11/extras/Mesa/src/mesa/swrast_setup/ss_context.c \
                           nx-X11/extras/Mesa/src/mesa/swrast_setup/ss_context.h \
                           nx-X11/extras/Mesa/src/mesa/swrast_setup/ss_triangle.c \
                           nx-X11/extras/Mesa/src/mesa/swrast_setup/ss_triangle.h \
                           nx-X11/extras/Mesa/src/mesa/swrast_setup/ss_tritmp.h \
                           nx-X11/extras/Mesa/src/mesa/swrast_setup/swrast_setup.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_feedback.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_feedback.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_fog.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_fog.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_imaging.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_lines.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_lines.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_linetemp.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_logic.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_logic.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_masking.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_masking.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_nvfragprog.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_nvfragprog.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_pixeltex.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_pixeltex.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_points.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_points.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_pointtemp.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_readpix.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_span.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_span.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_spantemp.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_stencil.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_stencil.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_texstore.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_texture.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_texture.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_triangle.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_triangle.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_trispan.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_tritemp.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/swrast.h \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_zoom.c \
                           nx-X11/extras/Mesa/src/mesa/swrast/s_zoom.h \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_array_api.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_array_api.h \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_array_import.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_array_import.h \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_context.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_context.h \
                           nx-X11/extras/Mesa/src/mesa/tnl/tnl.h \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_pipeline.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_pipeline.h \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_save_api.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_save_api.h \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_save_loopback.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_save_playback.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_arbprogram.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_arbprogram.h \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_arbprogram_sse.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_cliptmp.h \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_cull.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_fog.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_light.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_lighttmp.h \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_normals.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_points.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_program.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_render.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_rendertmp.h \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_texgen.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_texmat.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vb_vertex.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vertex.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vertex_generic.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vertex.h \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vertex_sse.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vp_build.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vp_build.h \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vtx_api.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vtx_api.h \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vtx_eval.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vtx_exec.c \
                           nx-X11/extras/Mesa/src/mesa/tnl/t_vtx_generic.c \
                           nx-X11/extras/Xpm/lib/Attrib.c \
                           nx-X11/extras/Xpm/lib/CrBufFrI.c \
                           nx-X11/extras/Xpm/lib/CrBufFrP.c \
                           nx-X11/extras/Xpm/lib/CrDatFrI.c \
                           nx-X11/extras/Xpm/lib/CrDatFrP.c \
                           nx-X11/extras/Xpm/lib/create.c \
                           nx-X11/extras/Xpm/lib/CrIFrBuf.c \
                           nx-X11/extras/Xpm/lib/CrIFrDat.c \
                           nx-X11/extras/Xpm/lib/CrIFrP.c \
                           nx-X11/extras/Xpm/lib/CrPFrBuf.c \
                           nx-X11/extras/Xpm/lib/CrPFrDat.c \
                           nx-X11/extras/Xpm/lib/CrPFrI.c \
                           nx-X11/extras/Xpm/lib/data.c \
                           nx-X11/extras/Xpm/lib/hashtab.c \
                           nx-X11/extras/Xpm/lib/Image.c \
                           nx-X11/extras/Xpm/lib/Info.c \
                           nx-X11/extras/Xpm/lib/misc.c \
                           nx-X11/extras/Xpm/lib/parse.c \
                           nx-X11/extras/Xpm/lib/RdFToBuf.c \
                           nx-X11/extras/Xpm/lib/RdFToDat.c \
                           nx-X11/extras/Xpm/lib/RdFToI.c \
                           nx-X11/extras/Xpm/lib/RdFToP.c \
                           nx-X11/extras/Xpm/lib/rgb.c \
                           nx-X11/extras/Xpm/lib/scan.c \
                           nx-X11/extras/Xpm/lib/WrFFrBuf.c \
                           nx-X11/extras/Xpm/lib/WrFFrDat.c \
                           nx-X11/extras/Xpm/lib/WrFFrI.c \
                           nx-X11/extras/Xpm/lib/WrFFrP.c \
                           nx-X11/extras/Xpm/lib/xpm.h \
                           nx-X11/extras/Xpm/lib/XpmI.h \
                           nx-X11/include/ap_keysym.h \
                           nx-X11/include/bitmaps/1x1 \
                           nx-X11/include/bitmaps/2x2 \
                           nx-X11/include/bitmaps/black \
                           nx-X11/include/bitmaps/boxes \
                           nx-X11/include/bitmaps/calculator \
                           nx-X11/include/bitmaps/cntr_ptr \
                           nx-X11/include/bitmaps/cntr_ptrmsk \
                           nx-X11/include/bitmaps/cross_weave \
                           nx-X11/include/bitmaps/dimple1 \
                           nx-X11/include/bitmaps/dimple3 \
                           nx-X11/include/bitmaps/dot \
                           nx-X11/include/bitmaps/dropbar7 \
                           nx-X11/include/bitmaps/dropbar8 \
                           nx-X11/include/bitmaps/escherknot \
                           nx-X11/include/bitmaps/flagdown \
                           nx-X11/include/bitmaps/flagup \
                           nx-X11/include/bitmaps/flipped_gray \
                           nx-X11/include/bitmaps/gray \
                           nx-X11/include/bitmaps/gray1 \
                           nx-X11/include/bitmaps/gray3 \
                           nx-X11/include/bitmaps/grid16 \
                           nx-X11/include/bitmaps/grid2 \
                           nx-X11/include/bitmaps/grid4 \
                           nx-X11/include/bitmaps/grid8 \
                           nx-X11/include/bitmaps/hlines2 \
                           nx-X11/include/bitmaps/hlines3 \
                           nx-X11/include/bitmaps/icon \
                           nx-X11/include/bitmaps/keyboard16 \
                           nx-X11/include/bitmaps/left_ptr \
                           nx-X11/include/bitmaps/left_ptrmsk \
                           nx-X11/include/bitmaps/letters \
                           nx-X11/include/bitmaps/light_gray \
                           nx-X11/include/bitmaps/mailempty \
                           nx-X11/include/bitmaps/mailemptymsk \
                           nx-X11/include/bitmaps/mailfull \
                           nx-X11/include/bitmaps/mailfullmsk \
                           nx-X11/include/bitmaps/mensetmanus \
                           nx-X11/include/bitmaps/menu10 \
                           nx-X11/include/bitmaps/menu12 \
                           nx-X11/include/bitmaps/menu16 \
                           nx-X11/include/bitmaps/menu6 \
                           nx-X11/include/bitmaps/menu8 \
                           nx-X11/include/bitmaps/noletters \
                           nx-X11/include/bitmaps/opendot \
                           nx-X11/include/bitmaps/opendotMask \
                           nx-X11/include/bitmaps/plaid \
                           nx-X11/include/bitmaps/right_ptr \
                           nx-X11/include/bitmaps/right_ptrmsk \
                           nx-X11/include/bitmaps/root_weave \
                           nx-X11/include/bitmaps/scales \
                           nx-X11/include/bitmaps/sipb \
                           nx-X11/include/bitmaps/star \
                           nx-X11/include/bitmaps/starMask \
                           nx-X11/include/bitmaps/stipple \
                           nx-X11/include/bitmaps/target \
                           nx-X11/include/bitmaps/terminal \
                           nx-X11/include/bitmaps/tie_fighter \
                           nx-X11/include/bitmaps/vlines2 \
                           nx-X11/include/bitmaps/vlines3 \
                           nx-X11/include/bitmaps/weird_size \
                           nx-X11/include/bitmaps/wide_weave \
                           nx-X11/include/bitmaps/wingdogs \
                           nx-X11/include/bitmaps/woman \
                           nx-X11/include/bitmaps/xfd_icon \
                           nx-X11/include/bitmaps/xlogo11 \
                           nx-X11/include/bitmaps/xlogo16 \
                           nx-X11/include/bitmaps/xlogo32 \
                           nx-X11/include/bitmaps/xlogo64 \
                           nx-X11/include/bitmaps/xsnow \
                           nx-X11/include/DECkeysym.h \
                           nx-X11/include/extensions/bigreqstr.h \
                           nx-X11/include/extensions/composite.h \
                           nx-X11/include/extensions/compositeproto.h \
                           nx-X11/include/extensions/damageproto.h \
                           nx-X11/include/extensions/damagewire.h \
                           nx-X11/include/extensions/dmxext.h \
                           nx-X11/include/extensions/dmxproto.h \
                           nx-X11/include/extensions/dpms.h \
                           nx-X11/include/extensions/dpmsstr.h \
                           nx-X11/include/extensions/extutil.h \
                           nx-X11/include/extensions/lbxbuf.h \
                           nx-X11/include/extensions/lbxbufstr.h \
                           nx-X11/include/extensions/lbxdeltastr.h \
                           nx-X11/include/extensions/lbximage.h \
                           nx-X11/include/extensions/lbxopts.h \
                           nx-X11/include/extensions/lbxstr.h \
                           nx-X11/include/extensions/lbxzlib.h \
                           nx-X11/include/extensions/MITMisc.h \
                           nx-X11/include/extensions/mitmiscstr.h \
                           nx-X11/include/extensions/multibuf.h \
                           nx-X11/include/extensions/multibufst.h \
                           nx-X11/include/extensions/panoramiXext.h \
                           nx-X11/include/extensions/panoramiXproto.h \
                           nx-X11/include/extensions/Print.h \
                           nx-X11/include/extensions/Printstr.h \
                           nx-X11/include/extensions/randr.h \
                           nx-X11/include/extensions/randrproto.h \
                           nx-X11/include/extensions/record.h \
                           nx-X11/include/extensions/recordstr.h \
                           nx-X11/include/extensions/render.h \
                           nx-X11/include/extensions/renderproto.h \
                           nx-X11/include/extensions/security.h \
                           nx-X11/include/extensions/securstr.h \
                           nx-X11/include/extensions/shape.h \
                           nx-X11/include/extensions/shapestr.h \
                           nx-X11/include/extensions/shmstr.h \
                           nx-X11/include/extensions/sync.h \
                           nx-X11/include/extensions/syncstr.h \
                           nx-X11/include/extensions/vldXvMC.h \
                           nx-X11/include/extensions/Xag.h \
                           nx-X11/include/extensions/Xagsrv.h \
                           nx-X11/include/extensions/Xagstr.h \
                           nx-X11/include/extensions/xcmiscstr.h \
                           nx-X11/include/extensions/Xcup.h \
                           nx-X11/include/extensions/Xcupstr.h \
                           nx-X11/include/extensions/Xdbe.h \
                           nx-X11/include/extensions/Xdbeproto.h \
                           nx-X11/include/extensions/Xevie.h \
                           nx-X11/include/extensions/Xeviestr.h \
                           nx-X11/include/extensions/XEVI.h \
                           nx-X11/include/extensions/XEVIstr.h \
                           nx-X11/include/extensions/Xext.h \
                           nx-X11/include/extensions/xf86bigfont.h \
                           nx-X11/include/extensions/xf86bigfstr.h \
                           nx-X11/include/extensions/xf86dga1.h \
                           nx-X11/include/extensions/xf86dga1str.h \
                           nx-X11/include/extensions/xf86dga.h \
                           nx-X11/include/extensions/xf86dgastr.h \
                           nx-X11/include/extensions/xf86misc.h \
                           nx-X11/include/extensions/xf86mscstr.h \
                           nx-X11/include/extensions/xf86vmode.h \
                           nx-X11/include/extensions/xf86vmstr.h \
                           nx-X11/include/extensions/xfixesproto.h \
                           nx-X11/include/extensions/xfixeswire.h \
                           nx-X11/include/extensions/XI.h \
                           nx-X11/include/extensions/Xinerama.h \
                           nx-X11/include/extensions/XInput.h \
                           nx-X11/include/extensions/XIproto.h \
                           nx-X11/include/extensions/XKBgeom.h \
                           nx-X11/include/extensions/XKB.h \
                           nx-X11/include/extensions/XKBproto.h \
                           nx-X11/include/extensions/XKBsrv.h \
                           nx-X11/include/extensions/XKBstr.h \
                           nx-X11/include/extensions/XLbx.h \
                           nx-X11/include/extensions/XRes.h \
                           nx-X11/include/extensions/XResproto.h \
                           nx-X11/include/extensions/XShm.h \
                           nx-X11/include/extensions/xtestext1.h \
                           nx-X11/include/extensions/XTest.h \
                           nx-X11/include/extensions/xteststr.h \
                           nx-X11/include/extensions/xtrapbits.h \
                           nx-X11/include/extensions/xtrapddmi.h \
                           nx-X11/include/extensions/xtrapdi.h \
                           nx-X11/include/extensions/xtrapemacros.h \
                           nx-X11/include/extensions/xtraplib.h \
                           nx-X11/include/extensions/xtraplibp.h \
                           nx-X11/include/extensions/xtrapproto.h \
                           nx-X11/include/extensions/Xv.h \
                           nx-X11/include/extensions/Xvlib.h \
                           nx-X11/include/extensions/XvMC.h \
                           nx-X11/include/extensions/XvMClib.h \
                           nx-X11/include/extensions/XvMCproto.h \
                           nx-X11/include/extensions/Xvproto.h \
                           nx-X11/include/fonts/font.h \
                           nx-X11/include/fonts/fontstruct.h \
                           nx-X11/include/fonts/FS.h \
                           nx-X11/include/fonts/fsmasks.h \
                           nx-X11/include/fonts/FSproto.h \
                           nx-X11/include/GL/glu.h \
                           nx-X11/include/GL/glx.h \
                           nx-X11/include/GL/glxint.h \
                           nx-X11/include/GL/glxmd.h \
                           nx-X11/include/GL/glxproto.h \
                           nx-X11/include/GL/glxtokens.h \
                           nx-X11/include/HPkeysym.h \
                           nx-X11/include/keysymdef.h \
                           nx-X11/include/keysym.h \
                           nx-X11/include/Sunkeysym.h \
                           nx-X11/include/Xalloca.h \
                           nx-X11/include/Xarch.h \
                           nx-X11/include/Xatom.h \
                           nx-X11/include/Xdefs.h \
                           nx-X11/include/XF86keysym.h \
                           nx-X11/include/Xfuncproto.h \
                           nx-X11/include/Xfuncs.h \
                           nx-X11/include/X.h \
                           nx-X11/include/Xmd.h \
                           nx-X11/include/Xosdefs.h \
                           nx-X11/include/Xos.h \
                           nx-X11/include/Xos_r.h \
                           nx-X11/include/Xproto.h \
                           nx-X11/include/Xprotostr.h \
                           nx-X11/include/Xthreads.h \
                           nx-X11/include/XWDFile.h \
                           nx-X11/lib/font/bitmap/bdfint.h \
                           nx-X11/lib/font/bitmap/pcf.h \
                           nx-X11/lib/font/include/bitmap.h \
                           nx-X11/lib/font/include/bufio.h \
                           nx-X11/lib/font/include/fntfil.h \
                           nx-X11/lib/font/include/fntfilio.h \
                           nx-X11/lib/font/include/fntfilst.h \
                           nx-X11/lib/font/include/fontencc.h \
                           nx-X11/lib/font/include/fontmisc.h \
                           nx-X11/lib/font/include/fontmod.h \
                           nx-X11/lib/font/include/fontshow.h \
                           nx-X11/lib/font/include/fontutil.h \
                           nx-X11/lib/font/include/fontxlfd.h \
                           nx-X11/lib/misc/strlcat.c \
                           nx-X11/lib/misc/strlcpy.c \
                           nx-X11/lib/oldX/X10.h \
                           nx-X11/lib/X11/cursorfont.h \
                           nx-X11/lib/X11/ImUtil.h \
                           nx-X11/lib/X11/Xcms.h \
                           nx-X11/lib/X11/XKBAlloc.c \
                           nx-X11/lib/X11/XKBGAlloc.c \
                           nx-X11/lib/X11/XKBlib.h \
                           nx-X11/lib/X11/XKBMAlloc.c \
                           nx-X11/lib/X11/XKBMisc.c \
                           nx-X11/lib/X11/XlibConf.h \
                           nx-X11/lib/X11/Xlib.h \
                           nx-X11/lib/X11/Xlibint.h \
                           nx-X11/lib/X11/Xlocale.h \
                           nx-X11/lib/X11/Xregion.h \
                           nx-X11/lib/X11/Xresource.h \
                           nx-X11/lib/X11/Xutil.h \
                           nx-X11/lib/Xau/AuDispose.c \
                           nx-X11/lib/Xau/AuFileName.c \
                           nx-X11/lib/Xau/AuGetBest.c \
                           nx-X11/lib/Xau/AuRead.c \
                           nx-X11/lib/Xau/Xauth.h \
                           nx-X11/lib/Xcomposite/Xcomposite.h \
                           nx-X11/lib/Xdamage/Xdamage.h \
                           nx-X11/lib/Xdmcp/Wrap.c \
                           nx-X11/lib/Xdmcp/Wrap.h \
                           nx-X11/lib/Xdmcp/Wraphelp.c \
                           nx-X11/lib/Xdmcp/Xdmcp.h \
                           nx-X11/lib/Xfixes/Xfixes.h \
                           nx-X11/lib/xkbfile/maprules.c \
                           nx-X11/lib/xkbfile/XKBbells.h \
                           nx-X11/lib/xkbfile/xkbconfig.c \
                           nx-X11/lib/xkbfile/XKBconfig.h \
                           nx-X11/lib/xkbfile/xkberrs.c \
                           nx-X11/lib/xkbfile/XKBfile.h \
                           nx-X11/lib/xkbfile/xkbmisc.c \
                           nx-X11/lib/xkbfile/xkbout.c \
                           nx-X11/lib/xkbfile/XKBrules.h \
                           nx-X11/lib/xkbfile/xkbtext.c \
                           nx-X11/lib/xkbfile/XKMformat.h \
                           nx-X11/lib/xkbfile/XKM.h \
                           nx-X11/lib/xkbfile/xkmread.c \
                           nx-X11/lib/Xrandr/Xrandr.h \
                           nx-X11/lib/Xrender/Xrender.h \
                           nx-X11/lib/xtrans/transport.c \
                           nx-X11/lib/xtrans/Xtrans.c \
                           nx-X11/lib/xtrans/Xtransdnet.c \
                           nx-X11/lib/xtrans/Xtrans.h \
                           nx-X11/lib/xtrans/Xtransint.h \
                           nx-X11/lib/xtrans/Xtranslcl.c \
                           nx-X11/lib/xtrans/Xtransos2.c \
                           nx-X11/lib/xtrans/Xtranssock.c \
                           nx-X11/lib/xtrans/Xtranstli.c \
                           nx-X11/lib/xtrans/Xtransutil.c \
                           nx-X11/programs/Xserver/hw/xfree86/common/compiler.h \
                           nx-X11/programs/Xserver/hw/xfree86/os-support/xf86_ansic.h \
                           nx-X11/programs/Xserver/hw/xfree86/os-support/xf86_libc.h \
                           nx-X11/programs/Xserver/hw/xfree86/xf86Version.h \
                           nx-X11/programs/Xserver/include/misc.h \
                           nx-X11/programs/Xserver/include/os.h \
                           nx-X11/programs/Xserver/mi/miinitext.c \
                           nx-X11/programs/Xserver/os/osdep.h \
                           nx-X11/programs/Xserver/Xext/extmod/modinit.h \
                           nx-X11/programs/Xserver/Xi/stubs.c \
                           $(NULL)

override_dh_auto_clean:
	rm -Rf nx-X11/.build-exports
	dh_auto_clean

override_dh_clean:
	rm -f nx*/configure
	rm -f nx*/changelog
	rm -f nx-X11/programs/Xserver/hw/nxagent/changelog
	rm -f nx-X11/programs/nxauth/changelog
	if [ ! -f replace.sh ] && [ ! -h replace.sh ]; then ln -s debian/Makefile.replace.sh replace.sh; fi
	. ./replace.sh; set -x; ls debian/*.install.in | while read file; do rm -f $$(string_rep $$file .install.in .install); done
	rm -fR replace.sh Makefile bin etc/rgb VERSION.x2goagent etc/keystrokes.cfg etc/nxagent.keyboard etc/x2goagent.keyboard
	rm -f debian/libnx-xinerama1.postinst
	rm -fR .preserve/
	if [ -f nxcomp/.VERSION.NoMachine ]; then mv nxcomp/.VERSION.NoMachine nxcomp/VERSION; fi
	dh_clean

override_dh_install:

	# handle builds for Debian squeeze (non multi-arch)
	. ./replace.sh; set -x; if [ -z "$(DEB_BUILD_MULTIARCH)" ]; then \
	    find debian/*.install.in | while read file; do \
	        cat $$file | sed -e 's#/\*/#/#g' > $$(string_rep $$file .install.in .install); \
	    done; \
	fi

	# remove static libs
	rm debian/tmp/usr/lib/$(DEB_BUILD_MULTIARCH)/libXcomp.a
	rm debian/tmp/usr/lib/$(DEB_BUILD_MULTIARCH)/libXcompshad.a

	# remove extras, GL, and other unneeded headers
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/GL/
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/bitmaps/
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/XInput.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/XK*.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/*Xv*.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/xtrap*.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/Print*.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/XRes*.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/record*.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/xf86vmode.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/xf86vmstr.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/xf86misc.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/xf86dga1.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/xf86dgastr.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/xf86dga.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/xf86dga1str.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/xf86mscstr.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/dmxext.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/dmxproto.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/bigreqstr.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/xcmiscstr.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/XIproto.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/xf86bigfstr.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/xf86bigfont.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/extensions/XI.h
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/fonts/
	rm -R debian/tmp/usr/include/$(DEB_BUILD_MULTIARCH)/nx/X11/Xtrans/

	dh_install --fail-missing

override_dh_auto_install:
	PREFIX=/usr dh_auto_install -Smakefile

override_dh_auto_build:

	# create copies of upstream changelogs so that names apply to Debian policy...
	cp -a nx-X11/CHANGELOG nx-X11/changelog
	cp -a nxcomp/CHANGELOG nxcomp/changelog
	if [ -f nxcomp/VERSION ]; then cp nxcomp/VERSION nxcomp/.VERSION.NoMachine; fi
	cp -a nxcompext/CHANGELOG nxcompext/changelog
	cp -a nxcompshad/CHANGELOG nxcompshad/changelog
	cp -a nx-X11/programs/Xserver/hw/nxagent/CHANGELOG nx-X11/programs/Xserver/hw/nxagent/changelog
	cp -a nx-X11/programs/nxauth/CHANGELOG nx-X11/programs/nxauth/changelog
	cp -a nxproxy/CHANGELOG nxproxy/changelog
	ln -s debian/Makefile.nx-libs Makefile
	ln -s debian/Makefile.replace.sh replace.sh
	ln -s debian/wrappers bin
	mkdir -p etc/
	ln -s ../debian/keystrokes.cfg etc/keystrokes.cfg
	ln -s debian/rgb
	ln -sf debian/VERSION VERSION.x2goagent
	ln -sf ../debian/VERSION nxcomp/VERSION

	# let's prep the libnx-xinerama1.postinst script with the value of the build systems's DEB_BUILD_MULTIARCH variable
	sed debian/libnx-xinerama1.postinst.in -e 's/#DEB_BUILD_MULTIARCH#/$(DEB_BUILD_MULTIARCH)/' > debian/libnx-xinerama1.postinst

	# make a copy of code to be preserved for build
	mkdir -p .preserve
	for path in $(PRESERVE_SYMLINKED_FILES); do test -d $$path && mkdir -p .preserve/$$path || mkdir -p .preserve/$$(dirname $$path); cp -av $$path .preserve/$$path; done

	# remove unused code / bundled libraries (see at the top of the debian/rules file)
        # for the exact list of files and folders
	rm -Rf $(UNUSED_FOLDERS)
	rm -Rf $(CLEANUP_FOLDERS)

	# copy to-be-preserved files back into code tree
	cp -av .preserve/* .
	rm -Rf .preserve/

	SHLIBDIR=$(LIBDIR) PREFIX=/usr dh_auto_build --parallel

override_dh_strip:
	dh_strip -plibnx-x11-6 --dbg-package=libnx-x11-6-dbg
	dh_strip -plibnx-xau6 --dbg-package=libnx-xau6-dbg
	dh_strip -plibnx-xcomposite1 --dbg-package=libnx-xcomposite1-dbg
	dh_strip -plibnx-xdamage1 --dbg-package=libnx-xdamage1-dbg
	dh_strip -plibnx-xdmcp6 --dbg-package=libnx-xdmcp6-dbg
	dh_strip -plibnx-xext6 --dbg-package=libnx-xext6-dbg
	dh_strip -plibnx-xfixes3 --dbg-package=libnx-xfixes3-dbg
	dh_strip -plibnx-xinerama1 --dbg-package=libnx-xinerama1-dbg
	dh_strip -plibnx-xpm4 --dbg-package=libnx-xpm4-dbg
	dh_strip -plibnx-xrandr2 --dbg-package=libnx-xrandr2-dbg
	dh_strip -plibnx-xrender1 --dbg-package=libnx-xrender1-dbg
	dh_strip -plibnx-xtst6 --dbg-package=libnx-xtst6-dbg
	dh_strip -plibxcomp3 --dbg-package=libxcomp3-dbg
	dh_strip -plibxcompshad3 --dbg-package=libxcompshad3-dbg
	dh_strip -plibxcompext3 --dbg-package=libxcompext3-dbg
	dh_strip -pnxagent --dbg-package=nxagent-dbg
	dh_strip -pnxproxy --dbg-package=nxproxy-dbg
	dh_strip -pnxauth --dbg-package=nxauth-dbg

